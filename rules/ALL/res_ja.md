<sub>[READMEへ](../../README.md)</sub>

[日本語](./res_ja.md) | [English](./res_en.md)

# Restaurant

参考動画: https://www.youtube.com/watch?v=CmZ_jPVntP8

> [!NOTE]  
> この動画は過去に実施された競技の様子である．今年の競技ルールとは異なる可能性がある．


## メインゴール (Main Goal)

このタスクでは，ロボットはレストランのウエイターとして働く．
ロボットは未知環境内で，クライアントから注文を取り，配膳する．


## フォーカス (Focus)

タスクプランニング，オンラインマッピング，未知環境でのナビゲーション，ジェスチャー検出，言葉による対話，マニピュレーション．


## セットアップ (Setup)

- **ロケーション**: 現実のレストラン環境か，それに似た未知環境が用意される．本タスクではアリーナはそのまま使われない．
  - **テストエレア**: レストランの位置が，競技が開始する直前まで公開しない.
  - **開始地点**: ロボットは`キッチンバー`の側からスタートする．レストランのキッチンに設置されているテーブルを使用する．
  - **注文地点**: 観客が座っている近いところとなる.
- **オペレーター**: 競技する参加チームのメンバー以外の人がボランティアとして参加することができる.
  - **顧客**: チームメンバーでない顧客が着席するテーブルが少なくとも3つ用意される．ただし，少なくとも2つの注文が実施される．
  - **バーマン**: チームメンバーでないバーマンが，キッチンバーの反対側でロボットを待つ．彼の役割はロボットに指示を出したり，ロボットが取った注文に従ってオブジェクトを用意することである．
- **備品**
  - **キッチンバー**: レストランのキッチン（または，そのように定義される場所）の近くにテーブルが用意され，バーカウンターとして使用される．そこにロボットから指示された物体が配置される．
  - **顧客エレア**: 顧客が事前に公開されないテーブルの近くの椅子に座る．
- **物体**: 物体は発表された物体リストから選択される．未知物体はないとする.
  - **食品**: `Food`カテゴリの物体のこと.
  - **飲物**: `Drink`カテゴリの物体のこと．
  - **カスタムコンテナ**: ロボットはオブジェクトを配膳するために，チームが用意したカスタムコンテナを使用できる．
- **競技時間**: 競技時間は最大15分である．


## 手順 (Procedure)

### スタートフェーズ (Starting Phase)

1. **セットアップ**: `TC`はチームにロボットを`開始地点`に移動するように指示する．
2. **開始**: `TC`は`開始合図`を与え，タイマーを開始する．同時に，チームは最後の簡単なセットアップ（スタートボタンを押すなど）を完了し，エリアを離れる．2つ以上のボタンを押すなどの複雑なセットアップ手順は許可されていない．

### 注文フェーズ (Order Phase)

1. **顧客検出**: ロボットは，注文を希望する顧客を識別する必要がある．その際，手を振っている人を認識する．
2. **移動確認**: ロボットは，キッチンバーから確認せずに移動することはできない．バーマンに注文を取る意向を確認する必要がある．バーマンが拒否した場合，ロボットは`顧客検出`を再開することが求められる．許可をとった場合，ロボットは続行できる．
3. **ナビゲーション**: ロボットがバーマンから顧客側に近づいて良いという確認を得たら，ロボットは手を振っていた顧客の方に自律的に移動する．
4. **注文受付**: ロボットが顧客の位置（顧客がロボットに近づく必要がないほど近い）に到達したら，ロボットは注文を受け取ることができる．**注文する商品の数は2つとする**．
5. **注文確認**: ロボットは，注文を顧客に確認するか，注文を正しく理解したことを表示するかが求められる．
6. **注文リクエスト**: ロボットはキッチンバーに戻り，バーマンに注文された商品を伝える．これらの商品は，テーブルの上に置かれる．


### デリバリーフェーズ (Delivery Phase)

1. **商品把持**: ロボットはテーブルの上に置かれた商品を掴む．
2. **ナビゲーション**: ロボットは自律的に注文した顧客の方に移動する．
3. **引き渡し**: ロボットは注文を顧客のテーブルの上に配置する．
4. **待機**: 注文が完了したら，ロボットはキッチンバーに戻る必要がある．注文の受付が待っている顧客がいる場合，`注文フェーズ`を繰り返すことが必要である．（このタスクには最低2つの注文がある）．


## デウス・エクス・マキナ (Deus ex Machina)

本タスクでは，次の`デウス・エクス・マキナ`が採用される．
該当アクションの点数は入らないが，より簡単な手法で部分的なタスクをスキップし，全体的なタスクを継続することができる．

| Action | Bypassing |
| --- | --- |
| 顧客検出 | 顧客にARマーカーを持たせる |
| キッチンバー・顧客への移動 | 人の支援で目的地へ到着する |
| 注文認識 | QRコードにより注文をロボットに伝える |
| 注文された商品を把持する・配置する | バーマンや顧客の支援で物体を把持・配置させる |

## スコアシート (Score Sheet)

## 日本語翻訳

| Action | Score |
| --- | --- |
| **メインタスク** | |
| 1. 注文フェーズ | |
| &emsp; - 呼び出しまたは手を振っている顧客を検出 | 2x40 |
| &emsp; - 顧客のテーブルに到達 | 2x40 |
| &emsp; - 注文を正しく取る | 2x40 |
| &emsp; - キッチンバーに戻る | 2x15 |
| 2. デリバリーフェーズ | |
| &emsp; - バーマンに注文された商品をリクエスト | 2x10 |
| &emsp; - バーマンから与えられた商品を把持 | 2x*n*x22.5 |
| &emsp; - 注文した顧客の位置に戻る | 2x15 |
| &emsp; - 商品をテーブルの上に配置 | 2x*n*x22.5 |
|  |  |
| **ペナルティ** |  |
| 注文受付中に顧客に注意を払っていない | -50 |
| 不参加（無断） | -500 |
|  |  |
| 合計（ボーナスタスクを含む） | 500 |

> [!NOTE]
> *n*: 把持/配置した商品の数．

> [!CAUTION]
> 注文が正しく取られなかった場合，次の顧客の注文まで，獲得したポイントは**半減**される．

<!-- **得点係用のスコアシート**: (TBD)RES-score_sheet -->
**得点係用のスコアシート**: [RES-score_sheet](./doc/iHR-C3_RES-score_sheet.pdf)


## 指示 (Instructions)

### ボランティアへ (To Volunteer)

本タスクにはボランティアが関与しない．
- 客を演じるボランティアを3名選ぶ．
- バーマンを演じるボランティアを1名選ぶ．
- 競技が始まる**30分前**に集まる．
- タスクの情報についての指示を受ける．
- ボランティアは**ロボットからのみの指示**に従い，自分自身で行動しないでください．

### 得点係へ (To Scorer)

得点係は*General Rules*の[採点方法](./grr_ja.md#採点方法scoring-system)に定義されているように選ばれ，以下のタスクを行う．

- 競技が始まる**30分**前に集まる．
- スコアシートの情報についての指示を受ける．
- 競技チームの競技をスコアリングする．
- 他の得点係とTCとスコアを確認し合う．
- スコアシートをTCに提出する．

### TCへ (To TC)

- `セットアップデー`中:
  - `テストエレア`の場所を確認する．
  - `Food`と`Drink`カテゴるの物体をアナウンスする．
- 競技開始直前:
  - `Food`と`Drink`カテゴるの物体を用意する．
- 競技中:
  - `テストエレア`が事前にマッピングされていないか確認する．
