<sub>[READMEへ](../../README.md)</sub>

[日本語](./cml_ja.md) | [English](./cml_en.md)

# Carry My Luggage（CML）

参考動画: https://youtu.be/dzyJ1dHTulc

> [!NOTE]  
> この動画は過去に実施された競技の様子である．今年の競技ルールとは異なる可能性がある．


## メインゴール (Main Goal)

オペレーターが外に駐車された車まで荷物を運搬することを，ロボットが支援する状況を想定して実施される．
ロボットは荷物を掴んだ後，`既知環境`から`未知環境`までオペレータ追従し，荷物運搬の支援を行う．
その後，ロボットは自律的に`開始地点`（`既知環境`）まで戻る．


## フォーカス (Focus)

指差し認識，マニピュレーション，人追従走行，地図なしのナビゲーション，ソーシャルナビゲーション．


## セットアップ (Setup)

- **ロケーション**: 競技はアリーナの内外で行われる．
  - **既知環境**: `アリーナ内`は事前にマッピングすることができる．
  - **未知環境**: `アリーナ外`は事前にマッピングすることが禁止されている．
  - **開始地点**: ロボットは`リビングルーム`のあらかじめ決められた場所でスタートし，`setup day`に公開される．
  - **目的地点**: 荷物を受け渡す最終地点は，競技開始時にTCによって決定される．
- **荷物**: 2つのバッグを設置する．
  - **配置場所**: オペレーターの近く（2\[m\]以内の距離でロボットから見える位置）に配置され，具体的な場所は`setup day`に公開される．
  - **サイズ**: 350×100×350\[mm\] 以内の大きさのバッグが用いられる．
- **オペレーター**: オペレーターは，ロボットの前に立って競技で使用するバッグを指さす．オペレータはボランティアより選出される．
- **制限時間**: 7分


## 手順 (Procedure)

### スタートフェーズ (Starting Phase)

1. **セットアップ**: `TC`は，チームにロボットを開始地点へ移動させるよう指示する．
2. **開始**: `TC`は開始の合図を出し，タイマーをスタートさせる．同時にチームは最後の簡単なセットアップ（スタートボタンを押す等）を完了し，開始地点を離れる．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められない．
3. **指差し**: オペレータは開始の合図と同時に，2つのバッグの内，事前に指定されたバッグの方を指さす．
4. **把持**: ロボットは，オペレータが指さしたバッグを認識し，それを把持する．

### フォロミーフェーズ (Follow-Me Phase)

1. **運搬開始**: ロボットがバッグを把持し追従可能な状態になったら，ロボットはオペレーターにその主旨を伝える．
2. **歩行**: その後，オペレータは`既知環境`から`未知環境`に向かって歩き始める．
3. **人追従**: ロボットは歩き始めたオペレータを追従し，走行する．オペレータが`ゴール時点`にたどり着いた場合，オペレータからその旨を伝えてもらう．
4. **ボーナス**: 追従中，以下最大3種類の障害物が出現する．各障害物の有無は事前にチームが指定する．
    - 地面にある小さな物体（積み木など）
    - 見づらい3Dオブジェクト（椅子やグラスなど）
    - 開閉式バリア（ガイドポールなど）

> [!CAUTION]
> **Natural walking**: オペレータは歩行を開始した後，ロボットの方を振り返ること，歩行を止めることはできない．

### ナビゲーションフェーズ (Navigation Phase)

1. **受け渡し**: オペレータはロボットに`ゴール地点`に着いたことを伝えた後，ロボットはオペレーターにバッグを渡す．
2. **ナビゲーション**: ロボットは`未知環境`から`既知環境`にある`開始地点`まで自律的に移動する．
3. **ゴール**: ロボットが`開始地点`へ戻ったら，タスク終了になる．
4. **ボーナス**: ロボットがゴール付近にできた列（2-4名）の最後尾へ並ぶ．


## デウス・エクス・マキナ (Deus ex Machina)

本タスクでは，次のデウス・エクス・マキナが採用される．
該当アクションの点数は入らないが，より簡単な手法で部分的なタスクをスキップし，全体的なタスクを継続することができる．

| Action | Bypassing |
| --- | --- |
| バッグの数 | 設置されているバッグの数は1つにする |
| バッグの把持 | ロボットが選択したバッグを，オペレータがロボットに持たせる．その際，ロボットがオペレーターにバッグの位置を伝える |
| マーカを用いた人追従走行 | マーカをオペレータに持たせた状態または取り付けた状態で人追従走行を行う |


## スコアシート (Score Sheet)

| Action | Score |
| --- | :---: |
| **メインタスク** |  |
| 1. スタートフェーズ | |
| &emsp; - オペレータが選択したバッグを検出する | 50 |
| &emsp; - 選択されたバッグを把持する | 100 |
| 2. フォロミーフェーズ | |
| &emsp; - オペレーターを追従してアリーナの外に出る | 50 |
| &emsp; - オペレーターを追従してアリーナの外にある`ゴール地点`へ着く | 50 |
| 3. ナビゲーションフェーズ |  |
| &emsp; - 自律的にアリーナ内に入る | 25 |
| &emsp; - 自律的に`開始地点`へ戻る | 25 |
|  |  |
| **ボーナスタスク**† |  |
| 2. フォロミーフェーズ | |
| &emsp; - 地面にある小さな物体（積み木など）を回避する | 50 |
| &emsp; - 見づらい3Dオブジェクト（椅子やグラスなど）を回避する | 50 |
| &emsp; - 開閉式バリア（ガイドポールなど）を回避する | 50 |
| 3. ナビゲーションフェーズ |  |
| &emsp; - ゴール地点にできた列の最後尾に並ぶ | 50 |
| **ペナルティ** |  |
| 不参加（無断） | -500 |
|  |  |
| 合計（ボーナスタスクを含む） | 500 |

> [!NOTE]
> ボーナススコアは，対象となるフェーズのメインタスクを最低一つ達成した場合にのみ獲得可能である．

**得点係用のスコアシート**: [CML-score_sheet](./doc/RCJ2024_OPL_CML-score_sheet.pdf)


## 指示 (Instructions)

### ボランティアへ (To Volunteer)

ボランティアは競技チームによって自由に選ばれ，以下のタスクを行う． 

- `フォロミーフェーズ`のため，ボランティアを1名選ぶ．
- `列並び`タスクのため，ボランティアを2名から4名選ぶ．
- 競技が始まる**30分前**に集まる．
- タスクの情報についての指示を受ける．
- ボランティアはロボットだけからの指示に従い，自分自身で行動しないでください．

> [!NOTE]
> ボランティアできる人数が足りない場合，
他チームからの支援をお願いする場合がある．

### 得点係へ (To Scorer)

得点係は*General Rules*の[採点方法](./gr_ja.md#採点方法scoring-system)に定義されているように選ばれ，以下のタスクを行う．

- 競技が始まる**30分**前に集まる．
- スコアシートの情報についての指示を受ける．
- 競技チームの競技をスコアリングする．
- 他の得点係とTCとスコアを確認し合う．
- スコアシートをTCに提出する．

> [!WARNING]
> ゲストに関する情報は競技チームと共有してはいけない．
そのような行為はペナルティの付加や競技の失格につながる可能性がある．

### TCへ (To TC)

- `Setup Day`中:
  - ロボットの`開始地点`をアナウンスする．
  - 使用するバッグをアナウンスする．
  - 使用する障害物をアナウンスする
  - バッグが置かれる位置の候補をアナウンスする．
- 競技開始直前:
  - （`フォロミーフェーズ`のボーナスタスクに取り組む場合）障害物を設置する．
  - バッグを置く位置を指示する．
- 競技中:
  - オペレーターが指差すバッグを指示する．
  - `フォロミーフェーズ`の`ゴール地点`を指示する．
